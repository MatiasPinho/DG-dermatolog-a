---
import "../styles/global.css";

interface Props {
  title?: string;
}

const { title = "DG Dermoestética - Dermatología y Estética" } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="DG Dermoestética - Más de 30 años al servicio de la salud. Dermatología clínica, estética y láser."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Instrument+Serif:ital@0;1&display=swap"
      rel="stylesheet"
    />
    <title>{title}</title>
  </head>
  <body class="">
    <!-- Preloader -->
    <div
      id="preloader"
      class="fixed inset-0 z-[100] bg-[#FAFAFA] flex items-center justify-center overflow-hidden"
    >
      <div class="relative flex items-center justify-center">
        <!-- Letters Container -->
        <div
          class="flex items-center gap-1 relative z-10 scale-150 md:scale-[2]"
        >
          <span
            id="letter-D"
            class="text-8xl font-serif font-bold text-primary opacity-0 translate-y-10 inline-block pointer-events-none"
            >D</span
          >

          <!-- Expanded Text Container (The "middle" part) -->
          <div
            id="expand-text"
            class="w-0 overflow-hidden h-[6rem] flex items-center justify-center opacity-0"
          >
            <span
              class="text-3xl md:text-4xl font-sans font-medium text-text-dark whitespace-nowrap tracking-widest px-2 relative top-1"
            >
              DERMOESTÉTICA
            </span>
          </div>

          <span
            id="letter-G"
            class="text-8xl font-serif font-bold text-primary opacity-0 translate-y-10 inline-block pointer-events-none"
            >G</span
          >
        </div>

        <!-- Circular Ripple Effect Background -->
        <div
          id="ripple"
          class="absolute w-2 h-2 rounded-full bg-indigo-100/50 -z-10 opacity-0"
        >
        </div>
      </div>
    </div>

    <div id="main-content" class="opacity-0">
      <slot />
    </div>

    <script>
      import { gsap } from "gsap";

      document.addEventListener("DOMContentLoaded", () => {
        const tl = gsap.timeline();
        const mainContent = document.getElementById("main-content");
        const preloader = document.getElementById("preloader");
        const letterD = document.getElementById("letter-D");
        const letterG = document.getElementById("letter-G");
        const expandText = document.getElementById("expand-text");
        const ripple = document.getElementById("ripple");

        if (
          !preloader ||
          !letterD ||
          !letterG ||
          !expandText ||
          !ripple ||
          !mainContent
        )
          return;

        // Prevent scrolling during preloader
        document.body.style.overflow = "hidden";

        // Initial State Set (Safety)
        gsap.set([letterD, letterG], { y: 50, opacity: 0 });
        gsap.set(expandText, { width: 0, opacity: 0 });
        gsap.set(ripple, { scale: 0, opacity: 0 });
        gsap.set(mainContent, { opacity: 0, scale: 0.98 });

        // 1. Letters D and G drop in with heavy impact
        tl.to([letterD, letterG], {
          y: 0,
          opacity: 1,
          duration: 1.4,
          stagger: 0.15,
          ease: "elastic.out(1, 0.75)",
        })

          // 2. Letters move apart (margin increase) combined with Ripple
          .to(letterD, { x: -30, duration: 1.2, ease: "power3.inOut" }, "-=0.2")
          .to(letterG, { x: 30, duration: 1.2, ease: "power3.inOut" }, "<")

          // Ripple expansion behind
          .to(
            ripple,
            {
              scale: 150,
              opacity: 1,
              duration: 1.8,
              ease: "power2.out",
            },
            "-=1.2",
          )

          // 3. Middle Text Expand (Width animation)
          .to(
            expandText,
            {
              width: "auto",
              opacity: 1,
              duration: 1.2,
              ease: "expo.inOut",
            },
            "-=1.0",
          )

          // Text Fade In slightly delayed
          .to(
            expandText.querySelector("span"),
            {
              opacity: 1,
              duration: 0.5,
            },
            "<+=0.2",
          )

          // 4. Pause for impact/reading
          .to({}, { duration: 0.6 })

          // 5. Final Move Up and Fade Out Preloader
          .to(preloader, {
            yPercent: -100,
            duration: 1.2,
            ease: "power4.inOut",
            onComplete: () => {
              document.body.style.overflow = ""; // Restore scrolling
            },
          })

          // 6. Reveal Main Content (Scale up slightly for depth)
          .to(
            mainContent,
            {
              opacity: 1,
              scale: 1,
              duration: 1,
              ease: "power3.out",
            },
            "-=0.8",
          );
      });
    </script>
  </body>
</html>
