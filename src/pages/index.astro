---
import Layout from "../layouts/Layout.astro";
import Servicios from "./Servicios.astro";
import Professionals from "../components/Professionals.astro";
import BeforeAfterSlider from "../components/BeforeAfterSlider.astro";
---

<Layout>
 <!-- NAVBAR -->
 <nav class="fixed top-0 left-0 right-0 z-50 flex justify-center pt-4 px-6">
  <div class="glass-nav flex items-center gap-1 px-2 py-2 rounded-full">
   <!-- Logo -->
   <a
    href="/"
    class="flex items-center justify-center w-10 h-10 bg-primary/10 rounded-full mr-2 group shrink-0"
   >
    <svg
     xmlns="http://www.w3.org/2000/svg"
     width="20"
     height="20"
     viewBox="0 0 32 32"
     fill="none"
     class="transition-transform group-hover:rotate-45 duration-500 ease-out"
    >
     <circle cx="16" cy="16" r="3" fill="#3b3ba8"></circle>
     <line
      x1="16"
      y1="4"
      x2="16"
      y2="12"
      stroke="#3b3ba8"
      stroke-width="2.5"
      stroke-linecap="round"></line>
     <line
      x1="16"
      y1="20"
      x2="16"
      y2="28"
      stroke="#3b3ba8"
      stroke-width="2.5"
      stroke-linecap="round"></line>
     <line
      x1="4"
      y1="16"
      x2="12"
      y2="16"
      stroke="#3b3ba8"
      stroke-width="2.5"
      stroke-linecap="round"></line>
     <line
      x1="20"
      y1="16"
      x2="28"
      y2="16"
      stroke="#3b3ba8"
      stroke-width="2.5"
      stroke-linecap="round"></line>
     <line
      x1="7.5"
      y1="7.5"
      x2="12.5"
      y2="12.5"
      stroke="#3b3ba8"
      stroke-width="2.5"
      stroke-linecap="round"></line>
     <line
      x1="19.5"
      y1="19.5"
      x2="24.5"
      y2="24.5"
      stroke="#3b3ba8"
      stroke-width="2.5"
      stroke-linecap="round"></line>
     <line
      x1="7.5"
      y1="24.5"
      x2="12.5"
      y2="19.5"
      stroke="#3b3ba8"
      stroke-width="2.5"
      stroke-linecap="round"></line>
     <line
      x1="19.5"
      y1="12.5"
      x2="24.5"
      y2="7.5"
      stroke="#3b3ba8"
      stroke-width="2.5"
      stroke-linecap="round"></line>
    </svg>
   </a>
   <!-- Nav links -->
   <div class="hidden md:flex items-center">
    <a
     href="#"
     class="text-sm font-medium text-text-dark hover:text-primary px-4 py-2 rounded-full transition-colors duration-300 ease-out"
     >Dermatología Clínica</a
    >
    <a
     href="#"
     class="text-sm font-medium text-text-dark hover:text-primary px-4 py-2 rounded-full transition-colors duration-300 ease-out"
     >Dermatología Estética</a
    >
    <a
     href="#"
     class="text-sm font-medium text-text-dark hover:text-primary px-4 py-2 rounded-full transition-colors duration-300 ease-out"
     >Aparatología</a
    >
    <a
     href="#"
     class="text-sm font-medium text-text-dark hover:text-primary px-4 py-2 rounded-full transition-colors duration-300 ease-out"
     >Cosmiatría</a
    >
    <a
     href="#"
     class="inline-flex items-center bg-primary text-white pl-5 pr-1 py-1 rounded-full text-sm font-medium hover:bg-primary-light transition-colors duration-500 ease-out group"
    >
     <span class="mr-2">Contacto</span>
     <span
      class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center shrink-0 transition-transform duration-500 ease-out group-hover:translate-x-0.5 group-hover:-translate-y-0.5"
     >
      <svg
       xmlns="http://www.w3.org/2000/svg"
       width="13"
       height="13"
       viewBox="0 0 24 24"
       fill="none"
       stroke="currentColor"
       stroke-width="2.5"
       stroke-linecap="round"
       stroke-linejoin="round"
      >
       <line x1="7" y1="17" x2="17" y2="7"></line>
       <polyline points="7 7 17 7 17 17"></polyline>
      </svg>
     </span>
    </a>
   </div>
   <!-- Mobile menu button -->
   <button id="mobile-menu-btn" class="md:hidden flex flex-col gap-1.5 p-2">
    <span class="w-5 h-0.5 bg-primary block"></span>
    <span class="w-5 h-0.5 bg-primary block"></span>
    <span class="w-3.5 h-0.5 bg-primary block"></span>
   </button>
  </div>
 </nav>

 <!-- HERO SECTION -->
 <section class="px-4 md:px-6 pt-4 pb-4">
  <div class="relative min-h-[calc(100vh-2rem)] overflow-hidden rounded-3xl">
   <div class="px-6 md:pl-40 md:pr-6 pt-24 md:pt-28 relative z-10">
    <div class="flex flex-col">
     <div class="grid md:grid-cols-12 gap-4 md:gap-6 items-start">
      <!-- Left content -->
      <div class="md:col-span-6 pt-8 md:pt-16">
       <!-- Badge — NO opacity-0 here, GSAP handles initial state -->
       <div
        id="hero-badge"
        class="inline-flex items-center gap-2 glass-card rounded-full px-4 py-1.5 mb-8"
       >
        <span
         class="text-xs font-semibold tracking-widest text-primary uppercase"
         >+30 años de experiencia</span
        >
       </div>
       <!-- Heading -->
       <h1
        id="hero-heading"
        class="text-5xl md:text-6xl lg:text-7xl font-semibold text-text-dark leading-[0.95] mb-5"
        style="font-family: var(--font-sans);"
       >
        Dermatología<br /> y <em
         id="estetica-word"
         class="not-italic font-semibold text-primary"
         style="font-family: var(--font-serif); font-style: italic;"
        >
         <span class="letter">e</span><span class="letter">s</span><span
          class="letter">t</span
         ><span class="letter">é</span><span class="letter">t</span><span
          class="letter">i</span
         ><span class="letter">c</span><span class="letter">a</span>
        </em>
       </h1>
       <!-- Subtitle -->
       <p
        id="hero-sub"
        class="text-lg md:text-xl lg:text-1xl text-text-muted mb-12 max-w-lg"
       >
        Atención dermatológica realizada por profesionales médicos, con
        equipamiento de última generación y criterio clínico.
       </p>
       <!-- CTA Button -->
       <a
        id="hero-cta"
        href="#"
        class="inline-flex items-center bg-primary text-white pl-7 pr-2 py-2 rounded-full text-base md:text-lg font-medium hover:bg-primary-light transition-all duration-500 ease-out group relative overflow-hidden"
       >
        <span class="mr-4">Contactanos</span>
        <span
         class="w-11 h-11 md:w-12 md:h-12 bg-white/20 rounded-full flex items-center justify-center shrink-0 transition-transform duration-500 ease-out group-hover:translate-x-0.5 group-hover:-translate-y-0.5"
        >
         <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2.5"
          stroke-linecap="round"
          stroke-linejoin="round"
         >
          <line x1="7" y1="17" x2="17" y2="7"></line>
          <polyline points="7 7 17 7 17 17"></polyline>
         </svg>
        </span>
       </a>
       <!-- Hero Cards -->
       <div
        class="mt-14 grid grid-cols-2 gap-4 max-w-2xl relative overflow-visible"
       >
        <!-- Card 1: Estética Facial  -->
        <div class="card-item glass-card rounded-xl p-5 md:p-6">
         <h3 class="text-base md:text-lg font-semibold text-text-dark mb-2">
          Estética Facial
         </h3>
         <p class="text-xs md:text-sm text-text-muted mb-4 leading-relaxed">
          Peeling, Plasma Rico en Plaquetas, Láser CO2, Toxina Botulínica y más
         </p>
         <a
          href="#"
          class="inline-flex items-center gap-1.5 text-xs md:text-sm font-medium text-text-dark hover:text-primary transition-colors duration-300 ease-out group"
         >
          Saber más <svg
           xmlns="http://www.w3.org/2000/svg"
           width="12"
           height="12"
           viewBox="0 0 24 24"
           fill="none"
           stroke="currentColor"
           stroke-width="2.5"
           stroke-linecap="round"
           stroke-linejoin="round"
           class="transition-transform duration-300 ease-out group-hover:translate-x-0.5 group-hover:-translate-y-0.5"
          >
           <line x1="7" y1="17" x2="17" y2="7"></line>
           <polyline points="7 7 17 7 17 17"></polyline>
          </svg>
         </a>
        </div>
        <!-- Card 2: Años de experiencia + Image -->
        <div
         class="card-item flex gap-3 relative z-30"
         style="width: calc(100% + 10rem); max-width: none;"
        >
         <!-- Stats sub-card -->
         <div
          class="flex-1 glass-card rounded-xl p-5 md:p-6 flex flex-col justify-center"
         >
          <p class="text-xs text-text-muted mb-1.5 leading-tight">
           Tratamientos<br />realizados
          </p>
          <p class="text-2xl md:text-3xl font-bold text-text-dark leading-none">
           5,000+
          </p>
          <p class="text-[10px] md:text-xs text-text-muted mt-2">
           Con tecnología de última generación
          </p>
         </div>
         <!-- Image sub-card -->
         <div
          class="w-24 md:w-28 bg-gradient-to-b from-purple-100 to-purple-200 rounded-xl overflow-hidden shadow-lg flex-shrink-0"
         >
          <img
           src="/woman-cosmetologist-having-beauty-treatment.webp"
           alt="Tratamiento estético"
           class="w-full h-full object-cover"
           loading="lazy"
           decoding="async"
           width="112"
           height="140"
          />
         </div>
        </div>
       </div>
      </div>
      <!-- Right spacer for image -->
      <div class="md:col-span-6"></div>
     </div>
    </div>
   </div>
   <!-- Hero background image carousel -->
   <div
    id="hero-image"
    class="absolute top-0 right-0 w-1/2 h-full overflow-hidden rounded-3xl"
   >
    <!-- Image container with multiple images -->
    <div id="hero-images-container" class="relative w-full h-full">
     <!-- Image 1 -->
     <div class="hero-slide absolute inset-0 opacity-100" data-slide="0">
      <img
       src="/woman-checking-her-skin-mirror-after-receiving-cosmetic-treatment.webp"
       alt="Woman checking her skin after cosmetic treatment"
       class="w-full h-full object-cover object-center rounded-3xl"
       loading="eager"
       decoding="async"
       fetchpriority="high"
      />
     </div>
     <!-- Image 2 -->
     <div class="hero-slide absolute inset-0 opacity-0" data-slide="1">
      <img
       src="/woman-cosmetologist-having-beauty-treatment.webp"
       alt="Woman cosmetologist having beauty treatment"
       class="w-full h-full object-cover object-center rounded-3xl"
       loading="lazy"
       decoding="async"
      />
     </div>
     <!-- Image 3 -->
     <div class="hero-slide absolute inset-0 opacity-0" data-slide="2">
      <img
       src="/client-beautician-s-appointment-consultation-face-shaping-preparation-upcoming-procedures-visual-examination-problem-areas.webp"
       alt="Client consultation and skin examination"
       class="w-full h-full object-cover object-center rounded-3xl"
       loading="lazy"
       decoding="async"
      />
     </div>
    </div>
    <!-- DG badge over image -->
    <div class="absolute inset-0 flex items-center justify-center z-10">
     <div id="hero-badge-circle" class="relative w-44 h-44 md:w-52 md:h-52">
      <div class="glass-circle absolute inset-2 rounded-full"></div>
      <!-- Rotating text — will be animated by GSAP for better performance -->
      <svg
       viewBox="0 0 200 200"
       class="w-full h-full relative z-10"
       style="will-change: transform; transform: translateZ(0);"
      >
       <defs>
        <path
         id="circlePath"
         d="M 100,100 m -70,0 a 70,70 0 1,1 140,0 a 70,70 0 1,1 -140,0"></path>
       </defs>
       <text
        font-size="11.5"
        fill="#1a1a6e"
        font-weight="500"
        letter-spacing="3.5"
       >
        <textPath href="#circlePath">
         DG DERMOESTÉTICA | DERMATOLOGÍA Y ESTÉTICA |
        </textPath>
       </text>
      </svg>
      <!-- Center DG -->
      <div class="absolute inset-0 flex items-center justify-center z-20">
       <div
        class="w-16 h-16 md:w-20 md:h-20 rounded-full flex items-center justify-center border border-white/50"
       >
        <span
         class="text-xl md:text-2xl font-bold text-primary"
         style="font-family: var(--font-serif);">DG</span
        >
       </div>
      </div>
     </div>
    </div>
    <!-- Image carousel indicators -->
    <div
     id="hero-carousel-indicators"
     class="absolute bottom-8 left-1/2 -translate-x-1/2 z-20 flex items-center gap-4"
    >
     <div
      class="hero-indicator h-1 rounded-full w-32 md:w-40 relative overflow-hidden glass-indicator"
      data-indicator="0"
     >
      <div
       class="hero-indicator-progress absolute inset-0 bg-white rounded-full"
       style="transform: scaleX(0); transform-origin: left center;"
      >
      </div>
     </div>
     <div
      class="hero-indicator h-1 rounded-full w-32 md:w-40 relative overflow-hidden glass-indicator"
      data-indicator="1"
     >
      <div
       class="hero-indicator-progress absolute inset-0 bg-white rounded-full"
       style="transform: scaleX(0); transform-origin: left center;"
      >
      </div>
     </div>
     <div
      class="hero-indicator h-1 rounded-full w-32 md:w-40 relative overflow-hidden glass-indicator"
      data-indicator="2"
     >
      <div
       class="hero-indicator-progress absolute inset-0 bg-white rounded-full"
       style="transform: scaleX(0); transform-origin: left center;"
      >
      </div>
     </div>
    </div>
   </div>
  </div>
 </section>

 <Servicios />
 <Professionals />
 <BeforeAfterSlider />

 <script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  gsap.registerPlugin(ScrollTrigger);

  // =========================================
  //  PREMIUM GSAP ANIMATIONS - $5000 QUALITY
  //  Ultra-smooth, professional, spectacular animations
  //  Using advanced techniques: custom easing, split text,
  //  multi-layer parallax, micro-interactions
  // =========================================

  // Premium custom easing curves for luxury feel
  // Using GSAP's CustomEase or built-in premium easings
  // We'll use sophisticated built-in easings for maximum compatibility

  // Use rAF to ensure DOM is painted before we set initial states
  requestAnimationFrame(() => {
   // --- Cache all DOM refs once ---
   const heroImage = document.getElementById("hero-image");
   const heroImageImg = heroImage?.querySelector("img");
   const heroBadge = document.getElementById("hero-badge");
   const heroHeading = document.getElementById("hero-heading");
   const heroSub = document.getElementById("hero-sub");
   const heroCta = document.getElementById("hero-cta");
   const heroBadgeCircle = document.getElementById("hero-badge-circle");
   const cardItems = gsap.utils.toArray(".card-item") as HTMLElement[];
   const nav = document.querySelector("nav");
   const profHeading = document.querySelector(".professionals-heading");
   const profCards = gsap.utils.toArray(".prof-card") as HTMLElement[];
   const beforeAfterHeading = document.querySelector(".before-after-heading");
   const beforeAfterItems = gsap.utils.toArray(
    ".before-after-item"
   ) as HTMLElement[];
   const rotatingSvg = heroBadgeCircle?.querySelector("svg");

   // All hero elements to animate (excluding heroImage which has its own animation)
   const heroElements = [
    heroBadge,
    heroHeading,
    heroSub,
    heroCta,
    heroBadgeCircle,
    ...cardItems,
   ].filter(Boolean);

   // --- Set initial hidden state via GSAP (not CSS classes) ---
   // Use force3D and will-change for better performance
   gsap.set(heroElements, {
    opacity: 0,
    y: 30,
    force3D: true,
    transformOrigin: "center center",
   });

   // Hero image has separate animation without y transform to preserve rounded borders
   if (heroImage) {
    gsap.set(heroImage, {
     opacity: 0,
     scale: 1.02,
     force3D: true,
     transformOrigin: "center center",
    });
   }
   gsap.set(nav, {
    opacity: 0,
    y: -20,
    force3D: true,
    transformOrigin: "center center",
   });

   // Set will-change on elements that will be animated
   heroElements.forEach((el) => {
    if (el) (el as HTMLElement).style.willChange = "transform, opacity";
   });
   if (nav) (nav as HTMLElement).style.willChange = "transform, opacity";

   // --- UNIFIED HERO ENTRANCE TIMELINE ---
   // Fast, smooth, and uniform animations
   const unifiedEase = "power2.out";
   const fastEase = "power1.out";

   const tl = gsap.timeline({
    defaults: {
     ease: unifiedEase,
     force3D: true,
     transformOrigin: "center center",
    },
    onComplete: () => {
     // Re-enable glass effect on cards AFTER all animations are done
     cardItems.forEach((card) => {
      card.querySelectorAll(".glass-card").forEach((gc) => {
       gc.classList.add("animated");
       (gc as HTMLElement).style.willChange = "auto";
      });
      if (card.classList.contains("glass-card")) {
       card.classList.add("animated");
       card.style.willChange = "auto";
      }
     });
     if (heroBadge) {
      heroBadge.classList.add("animated");
      heroBadge.style.willChange = "auto";
     }

     // Remove will-change from all animated elements to free resources
     heroElements.forEach((el) => {
      if (el) (el as HTMLElement).style.willChange = "auto";
     });
     if (nav) (nav as HTMLElement).style.willChange = "auto";

     // Add completion class for CSS cleanup
     document.body.classList.add("animation-complete");
    },
   });

   // 1. Nav — appears first, very fast
   if (nav) {
    tl.to(
     nav,
     {
      opacity: 1,
      y: 0,
      duration: 0.5,
      ease: fastEase,
     },
     0
    );
   }

   // 2. Hero image — appears immediately with nav
   if (heroImage) {
    gsap.set(heroImage, { y: 0, x: 0 });
    tl.to(
     heroImage,
     {
      opacity: 1,
      scale: 1,
      y: 0,
      x: 0,
      duration: 0.7,
      ease: unifiedEase,
      onComplete: () => {
       // Clear transform completely to preserve rounded borders
       if (heroImage) {
        gsap.set(heroImage, { clearProps: "transform" });
       }
      },
     },
     0
    );
   }

   // 3. Badge circle — appears with image
   if (heroBadgeCircle) {
    gsap.set(heroBadgeCircle, {
     scale: 0.95,
     opacity: 0,
    });
    tl.to(
     heroBadgeCircle,
     {
      opacity: 1,
      y: 0,
      scale: 1,
      duration: 0.6,
      ease: unifiedEase,
     },
     0.1
    );
   }

   // 4. Badge — appears quickly after image
   if (heroBadge) {
    gsap.set(heroBadge, { scale: 0.95 });
    tl.to(
     heroBadge,
     {
      opacity: 1,
      y: 0,
      scale: 1,
      duration: 0.5,
      ease: unifiedEase,
     },
     0.2
    );
   }

   // 5. Heading — appears with badge
   if (heroHeading) {
    gsap.set(heroHeading, { opacity: 0, y: 20 });

    tl.to(
     heroHeading,
     {
      opacity: 1,
      y: 0,
      duration: 0.6,
      ease: unifiedEase,
     },
     0.3
    );

    // Animate "estética" word letter by letter with professional drawing effect
    const esteticaWord = document.getElementById("estetica-word");
    const esteticaLetters = esteticaWord?.querySelectorAll(
     ".letter"
    ) as NodeListOf<HTMLElement>;

    if (esteticaWord && esteticaLetters.length > 0) {
     // Set initial state for each letter - hidden with precise clip-path
     esteticaLetters.forEach((letter) => {
      gsap.set(letter, {
       opacity: 1,
       clipPath: "inset(0 100% 0 0)",
       transformOrigin: "left center",
       force3D: true,
      });
     });

     // Professional letter-by-letter animation with uniform timing
     esteticaLetters.forEach((letter, index) => {
      tl.to(
       letter,
       {
        clipPath: "inset(0 0% 0 0)",
        duration: 0.5,
        ease: "power2.out",
        force3D: true,
       },
       0.4 + index * 0.12
      );
     });
    }
   }

   // 6. Subtitle — appears right after heading
   if (heroSub) {
    gsap.set(heroSub, { opacity: 0, y: 15 });
    tl.to(
     heroSub,
     {
      opacity: 1,
      y: 0,
      duration: 0.5,
      ease: unifiedEase,
     },
     0.4
    );
   }

   // 7. CTA Button — appears with subtitle
   if (heroCta) {
    gsap.set(heroCta, { scale: 0.95, opacity: 0 });
    tl.to(
     heroCta,
     {
      opacity: 1,
      y: 0,
      scale: 1,
      duration: 0.5,
      ease: unifiedEase,
     },
     0.5
    );
   }

   // 8. Cards — appear together quickly
   if (cardItems.length > 0) {
    cardItems.forEach((card, index) => {
     gsap.set(card, {
      opacity: 0,
      y: 30,
     });

     tl.to(
      card,
      {
       opacity: 1,
       y: 0,
       duration: 0.5,
       ease: unifiedEase,
      },
      0.6 + index * 0.05
     );
    });
   }

   // =========================================
   //  PREMIUM HERO IMAGE CAROUSEL
   //  Professional automatic image carousel with smooth transitions
   // =========================================

   const heroSlides = document.querySelectorAll(
    ".hero-slide"
   ) as NodeListOf<HTMLElement>;
   const heroIndicators = document.querySelectorAll(
    ".hero-indicator"
   ) as NodeListOf<HTMLElement>;
   const heroIndicatorProgresses = document.querySelectorAll(
    ".hero-indicator-progress"
   ) as NodeListOf<HTMLElement>;
   let currentSlide = 0;
   let carouselInterval: ReturnType<typeof setInterval> | null = null;
   let progressTween: gsap.core.Tween | null = null;
   const slideDuration = 4000; // 4 seconds per slide

   if (
    heroSlides.length > 0 &&
    heroIndicators.length > 0 &&
    heroIndicatorProgresses.length > 0
   ) {
    // Initialize first slide
    gsap.set(heroSlides[0], { opacity: 1, scale: 1 });

    // Premium slide transition function
    const transitionToSlide = (nextIndex: number) => {
     const currentSlideEl = heroSlides[currentSlide];
     const nextSlideEl = heroSlides[nextIndex];
     const currentProgress = heroIndicatorProgresses[currentSlide];
     const nextProgress = heroIndicatorProgresses[nextIndex];

     if (!currentSlideEl || !nextSlideEl || !currentProgress || !nextProgress)
      return;

     // Kill any ongoing progress animations
     if (progressTween) {
      progressTween.kill();
      progressTween = null;
     }

     // Reset current progress bar to 0
     gsap.set(currentProgress, { scaleX: 0 });

     // Create master timeline for smooth transition
     const transitionTl = gsap.timeline({
      defaults: { ease: "power2.inOut", force3D: true },
     });

     // Fade out current slide with slight scale
     transitionTl.to(
      currentSlideEl,
      {
       opacity: 0,
       scale: 1.05,
       duration: 1.2,
       force3D: true,
      },
      0
     );

     // Fade in next slide with scale animation
     transitionTl.fromTo(
      nextSlideEl,
      {
       opacity: 0,
       scale: 0.95,
      },
      {
       opacity: 1,
       scale: 1,
       duration: 1.4,
       force3D: true,
      },
      0.2
     );

     // Reset next progress bar to 0 before starting animation
     transitionTl.set(nextProgress, { scaleX: 0 }, 0.2);

     currentSlide = nextIndex;
    };

    // Auto-advance carousel with progress animation
    const animateProgress = (
     indicatorIndex: number,
     onComplete?: () => void
    ) => {
     const progress = heroIndicatorProgresses[indicatorIndex];
     if (!progress) return;

     // Kill any existing progress animation
     if (progressTween) {
      progressTween.kill();
      progressTween = null;
     }

     // Reset and start progress animation from 0 to 1
     gsap.set(progress, { scaleX: 0, transformOrigin: "left center" });
     progressTween = gsap.to(progress, {
      scaleX: 1,
      duration: slideDuration / 1000,
      ease: "none",
      force3D: true,
      onComplete: () => {
       if (onComplete) {
        onComplete();
       }
      },
     });
    };

    const advanceToNextSlide = () => {
     const nextIndex = (currentSlide + 1) % heroSlides.length;
     transitionToSlide(nextIndex);
     // Start progress animation immediately after transition starts
     gsap.delayedCall(0.2, () => {
      animateProgress(nextIndex, advanceToNextSlide);
     });
    };

    const startCarousel = () => {
     // Clear any existing interval
     if (carouselInterval) {
      clearInterval(carouselInterval);
      carouselInterval = null;
     }

     // Start progress animation on current slide, which will auto-advance when complete
     animateProgress(currentSlide, advanceToNextSlide);
    };

    // Pause carousel on hover for better UX
    if (heroImage) {
     heroImage.addEventListener("mouseenter", () => {
      // Pause progress animation
      if (progressTween) {
       progressTween.pause();
      }
     });

     heroImage.addEventListener("mouseleave", () => {
      // Resume progress animation
      if (progressTween && progressTween.paused()) {
       progressTween.resume();
      } else if (!progressTween) {
       // If no progress animation, restart carousel
       startCarousel();
      }
     });
    }

    // Start carousel after initial animations complete
    tl.call(() => {
     // Wait a bit after initial animation, then start carousel
     gsap.delayedCall(2, () => {
      startCarousel();
     });
    });

    // Click indicators to navigate
    heroIndicators.forEach((indicator, index) => {
     indicator.addEventListener("click", () => {
      if (index !== currentSlide) {
       // Kill current progress
       if (progressTween) {
        progressTween.kill();
        progressTween = null;
       }
       transitionToSlide(index);
       // Restart carousel after transition
       gsap.delayedCall(0.2, () => {
        startCarousel();
       });
      }
     });

     // Add cursor pointer and hover effect
     indicator.style.cursor = "pointer";
     indicator.addEventListener("mouseenter", () => {
      gsap.to(indicator, {
       scaleY: 1.5,
       duration: 0.3,
       ease: "power2.out",
      });
     });
     indicator.addEventListener("mouseleave", () => {
      gsap.to(indicator, {
       scaleY: 1,
       duration: 0.3,
       ease: "power2.out",
      });
     });
    });
   }

   // --- PREMIUM SCROLL ANIMATIONS ---
   // Multi-layer parallax for depth and sophistication
   const heroImageImgs = heroImage?.querySelectorAll(
    ".hero-slide img"
   ) as NodeListOf<HTMLElement>;
   if (heroImageImgs && heroImageImgs.length > 0 && heroImage) {
    // Apply parallax to all slide images
    heroImageImgs.forEach((img) => {
     img.style.willChange = "transform";

     // Primary parallax - smooth and elegant
     gsap.to(img, {
      yPercent: 25,
      scale: 1.1,
      ease: "none",
      force3D: true,
      transformOrigin: "center center",
      scrollTrigger: {
       trigger: heroImage,
       start: "top top",
       end: "bottom top",
       scrub: 1.2, // Premium smooth scrub
       invalidateOnRefresh: true,
      },
     });
    });

    // Secondary parallax on badge circle for depth
    if (heroBadgeCircle) {
     gsap.fromTo(
      heroBadgeCircle,
      {
       yPercent: 0,
       scale: 1,
      },
      {
       yPercent: -15,
       scale: 0.95,
       ease: "none",
       force3D: true,
       scrollTrigger: {
        trigger: heroImage,
        start: "top top",
        end: "bottom top",
        scrub: 1.5,
        invalidateOnRefresh: true,
       },
      }
     );
    }
   }

   // Professionals section - premium reveal animations
   if (profHeading) {
    const headingText = profHeading.querySelector("h2");
    const headingP = profHeading.querySelector("p");

    (profHeading as HTMLElement).style.willChange = "transform, opacity";

    // Animate heading text with clip-path reveal
    if (headingText) {
     gsap.set(headingText, {
      opacity: 0,
      y: 40,
      clipPath: "inset(0 0 100% 0)",
      force3D: true,
     });
     gsap.to(headingText, {
      opacity: 1,
      y: 0,
      clipPath: "inset(0 0 0% 0)",
      duration: 1.0,
      ease: "expo.out",
      force3D: true,
      scrollTrigger: {
       trigger: profHeading,
       start: "top 85%",
       toggleActions: "play none none none",
      },
     });
    }

    // Animate paragraph with blur effect
    if (headingP) {
     gsap.set(headingP, {
      opacity: 0,
      y: 20,
      filter: "blur(8px)",
      force3D: true,
     });
     gsap.to(headingP, {
      opacity: 1,
      y: 0,
      filter: "blur(0px)",
      duration: 0.9,
      ease: "power2.out",
      force3D: true,
      scrollTrigger: {
       trigger: profHeading,
       start: "top 85%",
       toggleActions: "play none none none",
      },
     });
    }
   }

   // Professional cards - premium staggered reveal with 3D
   if (profCards.length > 0) {
    profCards.forEach((card, index) => {
     const cardImg = card.querySelector("img");
     const cardContent = card.querySelector("div");

     (card as HTMLElement).style.willChange = "transform, opacity";

     gsap.set(card, {
      opacity: 0,
      y: 60,
      rotationY: -10,
      transformPerspective: 1200,
      force3D: true,
     });

     if (cardImg) {
      gsap.set(cardImg, { scale: 1.2, opacity: 0 });
     }

     // Main card animation
     gsap.to(card, {
      opacity: 1,
      y: 0,
      rotationY: 0,
      duration: 1.0,
      ease: "power3.out",
      force3D: true,
      scrollTrigger: {
       trigger: card,
       start: "top 85%",
       toggleActions: "play none none none",
      },
     });

     // Image reveal with scale
     if (cardImg) {
      gsap.to(cardImg, {
       scale: 1,
       opacity: 1,
       duration: 1.2,
       ease: "expo.out",
       scrollTrigger: {
        trigger: card,
        start: "top 85%",
        toggleActions: "play none none none",
       },
      });
     }
    });
   }

   // Premium rotating SVG - buttery smooth continuous rotation
   if (rotatingSvg) {
    rotatingSvg.style.willChange = "transform";
    gsap.to(rotatingSvg, {
     rotation: 360,
     duration: 35, // Slower for more elegant feel
     ease: "none",
     repeat: -1,
     force3D: true,
     transformOrigin: "center center",
     immediateRender: false,
    });
   }

   // Premium hover interactions for cards
   cardItems.forEach((card) => {
    const cardLink = card.querySelector("a");
    const cardImg = card.querySelector("img");

    if (cardLink) {
     cardLink.addEventListener("mouseenter", () => {
      gsap.to(card, {
       y: -8,
       scale: 1.02,
       duration: 0.5,
       ease: "power2.out",
       force3D: true,
      });
     });

     cardLink.addEventListener("mouseleave", () => {
      gsap.to(card, {
       y: 0,
       scale: 1,
       duration: 0.5,
       ease: "power2.out",
       force3D: true,
      });
     });
    }

    if (cardImg) {
     card.addEventListener("mouseenter", () => {
      gsap.to(cardImg, {
       scale: 1.05,
       duration: 0.6,
       ease: "power2.out",
       force3D: true,
      });
     });

     card.addEventListener("mouseleave", () => {
      gsap.to(cardImg, {
       scale: 1,
       duration: 0.6,
       ease: "power2.out",
       force3D: true,
      });
     });
    }
   });

   // Before/After section - premium reveal animations
   if (beforeAfterHeading) {
    const headingText = beforeAfterHeading.querySelector("h2");
    const headingP = beforeAfterHeading.querySelector("p");

    (beforeAfterHeading as HTMLElement).style.willChange = "transform, opacity";

    // Animate heading text with clip-path reveal
    if (headingText) {
     gsap.set(headingText, {
      opacity: 0,
      y: 40,
      clipPath: "inset(0 0 100% 0)",
      force3D: true,
     });
     gsap.to(headingText, {
      opacity: 1,
      y: 0,
      clipPath: "inset(0 0 0% 0)",
      duration: 1.0,
      ease: "expo.out",
      force3D: true,
      scrollTrigger: {
       trigger: beforeAfterHeading,
       start: "top 85%",
       toggleActions: "play none none none",
      },
     });
    }

    // Animate paragraph with blur effect
    if (headingP) {
     gsap.set(headingP, {
      opacity: 0,
      y: 20,
      filter: "blur(8px)",
      force3D: true,
     });
     gsap.to(headingP, {
      opacity: 1,
      y: 0,
      filter: "blur(0px)",
      duration: 0.9,
      ease: "power2.out",
      force3D: true,
      scrollTrigger: {
       trigger: beforeAfterHeading,
       start: "top 85%",
       toggleActions: "play none none none",
      },
     });
    }
   }

   // Before/After items - premium staggered reveal
   if (beforeAfterItems.length > 0) {
    beforeAfterItems.forEach((item, index) => {
     const itemSlider = item.querySelector(".before-after-slider");
     const itemContent = item.querySelector("div:first-child");

     (item as HTMLElement).style.willChange = "transform, opacity";

     gsap.set(item, {
      opacity: 0,
      y: 60,
      rotationY: -10,
      transformPerspective: 1200,
      force3D: true,
     });

     // Main item animation
     gsap.to(item, {
      opacity: 1,
      y: 0,
      rotationY: 0,
      duration: 1.0,
      ease: "power3.out",
      force3D: true,
      scrollTrigger: {
       trigger: item,
       start: "top 85%",
       toggleActions: "play none none none",
      },
     });

     // Slider reveal with scale
     if (itemSlider) {
      gsap.fromTo(
       itemSlider,
       {
        scale: 0.95,
        opacity: 0,
       },
       {
        scale: 1,
        opacity: 1,
        duration: 1.2,
        ease: "expo.out",
        scrollTrigger: {
         trigger: item,
         start: "top 85%",
         toggleActions: "play none none none",
        },
        onComplete: () => {
         // Animate method badges after slider appears
         const methodBadges = item.querySelectorAll(
          ".method-badge"
         ) as NodeListOf<HTMLElement>;
         if (methodBadges.length > 0) {
          methodBadges.forEach((badge, badgeIndex) => {
           gsap.set(badge, {
            opacity: 0,
            y: 20,
            scale: 0.8,
            force3D: true,
           });
           gsap.to(badge, {
            opacity: 1,
            y: 0,
            scale: 1,
            duration: 0.5,
            ease: "power2.out",
            delay: badgeIndex * 0.1,
            force3D: true,
           });
          });
         }
        },
       }
      );
     }
    });
   }

   // Global ScrollTrigger config - optimized
   ScrollTrigger.config({
    limitCallbacks: true,
    autoRefreshEvents: "visibilitychange,DOMContentLoaded,load",
   });

   // Refresh ScrollTrigger after images load
   if (heroImageImg) {
    heroImageImg.addEventListener("load", () => {
     ScrollTrigger.refresh();
    });
   }
  });
 </script>

 <style is:global>
  /* Removed CSS animation - now handled by GSAP for better performance */
 </style>
</Layout>
